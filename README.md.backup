# Lighthouse SEO Dashboard

Monitor your website's performance, accessibility, and SEO scores with automated daily scans and AI-powered recommendations.

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/rocklandceo/lighthouse-public)
[![License: Apache-2.0](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)
[![Tests](https://img.shields.io/badge/tests-20%20passing-brightgreen.svg)](__tests__)

---

## 2-Minute Quick Start

Get your dashboard running in three steps:

### Step 1: Deploy to Vercel

Click the **Deploy with Vercel** button above, or:

1. Fork this repository
2. Go to [vercel.com](https://vercel.com) → **Add New Project**
3. Import your forked repository

### Step 2: Add Storage

1. In your Vercel project, go to **Storage** tab
2. Click **Create Database** → **KV**
3. Name it anything (e.g., "lighthouse-kv") and click **Create**

### Step 3: Configure Authentication

1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Create an **OAuth 2.0 Client ID** (Web application)
3. Add redirect URI: `https://YOUR-PROJECT.vercel.app/api/auth/callback/google`
4. In Vercel, add these environment variables:

| Variable | Value |
|----------|-------|
| `TARGET_BASE_URL` | Your website URL (e.g., `https://example.com`) |
| `DASHBOARD_URL` | Your Vercel URL (e.g., `https://your-project.vercel.app`) |
| `NEXTAUTH_SECRET` | Run `openssl rand -base64 32` to generate |
| `GOOGLE_CLIENT_ID` | From Google Cloud Console |
| `GOOGLE_CLIENT_SECRET` | From Google Cloud Console |

5. Click **Deploy**

Your first scan will run automatically the next morning at 2 AM UTC, or you can trigger one manually from GitHub Actions.

### First Run Checklist

After deployment, verify everything is working:

- [ ] Visit your dashboard URL - you should see the sign-in page
- [ ] Sign in with Google - you should be redirected to the dashboard
- [ ] If you see "No data available", that's expected before your first scan
- [ ] Check GitHub Actions → run the "Lighthouse Scan" workflow manually to get immediate data
- [ ] After the scan completes (~5-10 minutes), refresh your dashboard

---

## What You'll Get

### Performance Monitoring

- **Daily Lighthouse Scans**: Automated mobile and desktop scans
- **Score Tracking**: Historical trends with visual charts
- **Regression Alerts**: Slack notifications when scores drop

### SEO Insights

- **AI Recommendations**: Claude-powered SEO suggestions and quick wins
- **Content Gap Analysis**: Keywords your competitors rank for that you don't
- **Schema Markup**: Auto-generated JSON-LD suggestions

### Analytics Integration

- **Google Analytics**: Traffic metrics alongside performance data
- **Search Console**: Keyword rankings and click-through rates
- **Competitor Tracking**: Monitor how competitors are performing

---

## Complete Setup Guide

For detailed instructions including:

- Google OAuth setup with screenshots
- GitHub Actions configuration
- Optional integrations (AI, Analytics, Slack)
- Troubleshooting common issues

See **[docs/SETUP.md](docs/SETUP.md)**

---

## Environment Variables

### Required

| Variable | Description | Example |
|----------|-------------|---------|
| `TARGET_BASE_URL` | Website to monitor | `https://example.com` |
| `DASHBOARD_URL` | This dashboard's URL | `https://my-dashboard.vercel.app` |
| `NEXTAUTH_SECRET` | Auth encryption key | Generate with `openssl rand -base64 32` |
| `GOOGLE_CLIENT_ID` | Google OAuth client ID | `xxx.apps.googleusercontent.com` |
| `GOOGLE_CLIENT_SECRET` | Google OAuth secret | `GOCSPX-xxx` |

*Note: `KV_REST_API_URL` and `KV_REST_API_TOKEN` are auto-configured when you create Vercel KV storage.*

### Optional

| Variable | What It Enables |
|----------|-----------------|
| `APP_NAME` | Custom dashboard title |
| `SITE_DESCRIPTION` | Context for AI to give better recommendations |
| `ALLOWED_EMAIL_DOMAIN` | Restrict login to specific domain (e.g., `yourcompany.com`) |
| `ANTHROPIC_API_KEY` | AI-powered SEO insights and recommendations |
| `DATAFORSEO_LOGIN` | Competitor analysis and keyword tracking |
| `DATAFORSEO_PASSWORD` | (required with LOGIN) |
| `SLACK_WEBHOOK_URL` | Notifications for score changes |
| `CI_UPLOAD_SIGNING_KEY` | Secure CI uploads (recommended) |

See [.env.example](.env.example) for the complete list with documentation.

---

## Customization

### Branding

Make the dashboard your own with environment variables:

```bash
NEXT_PUBLIC_BRAND_NAME="My Company Dashboard"
NEXT_PUBLIC_BRAND_PRIMARY="#1a365d"
NEXT_PUBLIC_BRAND_ACCENT="#d97706"
```

Replace `public/brand/logo.svg` with your logo (40x40px SVG recommended).

See [docs/SETUP.md](docs/SETUP.md#customizing-branding) for all branding options.

### Score Thresholds

Adjust when you receive alerts by editing `scripts/notify-slack.mjs`:

```javascript
const SCORE_THRESHOLDS = {
  performance: 80,    // Alert if below 80
  accessibility: 85,
  'best-practices': 85,
  seo: 90,
};
```

---

## Troubleshooting

### "Sign in failed" or redirect errors

- Verify your redirect URI in Google Cloud Console matches exactly: `https://YOUR-URL/api/auth/callback/google`
- Check that `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` are set correctly

### Dashboard shows no data

- Scans run daily at 2 AM UTC - trigger manually from GitHub Actions for immediate results
- Check GitHub Actions logs for scan errors
- Verify `TARGET_BASE_URL` is publicly accessible

### AI insights not appearing

- Confirm `ANTHROPIC_API_KEY` is set in Vercel environment variables
- Check Vercel function logs for API errors

### CI upload fails with 401

- Ensure `CI_UPLOAD_SIGNING_KEY` matches in both GitHub Secrets and Vercel environment
- Uploads must occur within 5 minutes of signature generation

For more troubleshooting tips, see [docs/SETUP.md](docs/SETUP.md#troubleshooting).

---

## Optional Integrations

### AI Insights (Anthropic Claude)

Get intelligent SEO recommendations, content suggestions, and quick wins.

1. Get an API key from [console.anthropic.com](https://console.anthropic.com/)
2. Add `ANTHROPIC_API_KEY` to Vercel environment variables

### Competitor Analysis (DataForSEO)

Track competitor rankings and identify content gaps.

1. Create account at [dataforseo.com](https://dataforseo.com/)
2. Go to your **Dashboard** → **API Access** section
3. Generate or copy your **API Login** and **API Password**

   > **Important**: These are your *API credentials*, not your account login credentials.
   > The API Login is typically your email, and the API Password is a separate key generated in the API Access section.

4. Add these environment variables in Vercel:
   - `DATAFORSEO_LOGIN` = Your API Login (from API Access section)
   - `DATAFORSEO_PASSWORD` = Your API Password (from API Access section)

### Google Analytics

See traffic metrics alongside performance scores.

1. Enable Google Analytics Data API in Google Cloud
2. Create a service account with GA viewer access
3. Add `GOOGLE_ANALYTICS_PROPERTY_ID` and `GOOGLE_SERVICE_ACCOUNT_JSON`

### Slack Notifications

Get alerts when scores drop or thresholds are breached.

1. Create a Slack incoming webhook
2. Add `SLACK_WEBHOOK_URL` to GitHub repository secrets

---

## Local Development

```bash
# Clone and install
git clone https://github.com/YOUR_USERNAME/lighthouse-seo-dashboard.git
cd lighthouse-seo-dashboard
npm ci

# Configure environment
cp .env.example .env.local
# Edit .env.local with your values

# Start development server
npm run dev

# Run tests
npm test

# Run type checking
npm run typecheck

# Run linting
npm run lint

# Build for production
npm run build

# Run full verification (typecheck + lint + test + build)
npm run verify

# Run Lighthouse scans locally
npm run scan:desktop
npm run scan:mobile
```

### Local-Only Files

**Important**: Never commit environment files or local configuration to version control.

- `.env`, `.env.local`, `.env.*.local` - Contains secrets and credentials
- `.claude/`, `.taskmaster/` - Local AI assistant tooling
- `public/reports/` - Generated Lighthouse reports

These files are gitignored. Always use `.env.example` as your template when setting up locally.

### Available Scripts

| Command | Description |
|---------|-------------|
| `npm run dev` | Start development server |
| `npm run build` | Build for production |
| `npm run lint` | Run ESLint |
| `npm run typecheck` | Run TypeScript checks |
| `npm test` | Run test suite |
| `npm run verify` | Run full verification (typecheck + lint + test + build + public-ready check) |
| `npm run scan:desktop` | Run desktop Lighthouse scan |
| `npm run scan:mobile` | Run mobile Lighthouse scan |

---

## GitHub Actions (Optional)

The included workflow (`.github/workflows/unlighthouse.yml`) automates Lighthouse scans and uploads results to your dashboard.

### What It Does

1. **Daily at 2 AM UTC**: Runs mobile and desktop Lighthouse scans
2. Uploads results to your dashboard's KV storage
3. Checks for score regressions
4. Sends Slack notification (if configured)
5. Triggers Vercel redeploy (if configured)
6. Optionally runs competitor analysis

### Required Secrets

Set these in your GitHub repository: **Settings → Secrets and variables → Actions → New repository secret**

| Secret | Description | Required |
|--------|-------------|----------|
| `DASHBOARD_URL` | Your dashboard URL (e.g., `https://my-dashboard.vercel.app`) | Yes |
| `CI_UPLOAD_SIGNING_KEY` | Must match the key in Vercel environment. Generate with `openssl rand -hex 32` | Yes |

### Optional Secrets

| Secret | Description |
|--------|-------------|
| `SITEMAP_URL` | Custom sitemap URL (defaults to `TARGET_BASE_URL/sitemap.xml`) |
| `SLACK_WEBHOOK_URL` | Slack incoming webhook for notifications |
| `VERCEL_DEPLOY_HOOK` | Vercel deploy hook URL to trigger redeploy after scan |
| `KEEP_RUNS` | Number of historical runs to keep (default: 30) |
| `REGRESSION_THRESHOLD` | Score drop threshold for alerts (default: 5) |

### Manual Trigger

1. Go to your repository on GitHub
2. Click **Actions** tab
3. Select **Unlighthouse CI** workflow
4. Click **Run workflow**
5. Optionally check "Run competitor analysis"
6. Click **Run workflow** button

### Fork-Safe Design

The workflow gracefully skips steps when secrets are not configured:
- Missing `DASHBOARD_URL`: Skips upload
- Missing `SLACK_WEBHOOK_URL`: Skips notification
- Missing `VERCEL_DEPLOY_HOOK`: Skips redeploy trigger

This allows forks to run without failing, even without secrets configured.

---

## Project Structure

```
app/
├── api/                    # API routes
│   ├── ai-insights/        # AI analysis endpoints
│   ├── competitors/        # Competitor analysis
│   ├── reports/            # Lighthouse report management
│   └── auth/               # NextAuth handlers
├── auth/                   # Auth pages (signin, error)
└── page.tsx                # Main dashboard

components/                 # React components
lib/                        # Utilities, types, and config
scripts/                    # CI/CD and scan scripts
docs/                       # Documentation
__tests__/                  # Test files
```

---

## FAQ

**Q: How often do scans run?**
A: By default, daily at 2 AM UTC. You can change this in `.github/workflows/unlighthouse.yml` or trigger manually.

**Q: Can I monitor multiple websites?**
A: Each deployment monitors one website. Deploy multiple instances for multiple sites.

**Q: Is there a cost?**
A: The dashboard itself is free on Vercel's hobby tier. Optional integrations (Anthropic, DataForSEO) have their own pricing.

**Q: How do I restrict access to my team?**
A: Set `ALLOWED_EMAIL_DOMAIN=yourcompany.com` to only allow Google accounts from your domain.

**Q: Where is the data stored?**
A: In Vercel KV (Upstash Redis). Data is retained for 60 days by default.

---

## Security

### Upload Endpoint Authentication

The `/api/reports/upload` endpoint uses HMAC-SHA256 signatures for secure CI uploads:

- **Signature verification**: All uploads must include a valid HMAC signature
- **Replay protection**: Nonces prevent request replay attacks
- **Timestamp validation**: Requests expire after 5 minutes
- **Rate limiting**: 10 requests per minute per IP

### Authentication & Authorization

- **OAuth authentication**: Secure Google sign-in via NextAuth.js
- **Domain restriction**: Optional `ALLOWED_EMAIL_DOMAIN` to restrict access to your organization
- **Session management**: JWT-based sessions with 30-day expiration

### Data Security

- **Environment variables**: All secrets stored in environment variables, never in code
- **Vercel KV**: Data stored in encrypted Vercel KV (Upstash Redis)
- **HTTPS only**: All traffic encrypted in transit
- **No third-party tracking**: No analytics or tracking scripts

For security issues, please see [CONTRIBUTING.md](CONTRIBUTING.md#security) for responsible disclosure guidelines.

---

## Ownership and License

**Copyright 2026 Oliver Marler**

This project is licensed under the **Apache License 2.0** - see [LICENSE](LICENSE) for details.

Contributions are accepted under the CLA - see [CLA.md](CLA.md) for details.

### What This Means

- ✅ **Free to use** for commercial and non-commercial projects
- ✅ **Free to modify** and create derivative works
- ✅ **Free to distribute** original or modified versions
- ✅ **Patent grant** included for contributions
- ⚠️ **Trademark notice** required when redistributing
- ⚠️ **License and copyright notice** must be included

For more information, see <https://www.apache.org/licenses/LICENSE-2.0>

---

## Contributing

Contributions are welcome! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for:

- **Developer Certificate of Origin (DCO)** requirements
- **Contributor License Agreement (CLA)** - review [CLA.md](CLA.md)
- Development setup
- Code style guidelines
- Pull request process

**All commits must be signed off** with the `-s` flag:

```bash
git commit -s -m "Your commit message"
```

---

## Acknowledgments

Built with these excellent open source projects:

- [Unlighthouse](https://unlighthouse.dev) - Lighthouse CI scanning
- [Next.js](https://nextjs.org) - React framework
- [Recharts](https://recharts.org) - Data visualization
- [NextAuth.js](https://next-auth.js.org) - Authentication
- [Tailwind CSS](https://tailwindcss.com) - Styling

---

## Support

- **Issues**: [GitHub Issues](https://github.com/YOUR_USERNAME/lighthouse-seo-dashboard/issues)
- **Discussions**: [GitHub Discussions](https://github.com/YOUR_USERNAME/lighthouse-seo-dashboard/discussions)
